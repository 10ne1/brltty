all: debug
debug: app-debug
release: app-release
bundle: bundle-release
lint: lint-debug
install: install-debug

ANDROID_ROOT_NAME = brltty
ANDROID_CORE_NAME = core
ANDROID_APP_NAME = app
ANDROID_REPORT_NAME = lint

ANDROID_DEBUG_VARIANT = debug
ANDROID_RELEASE_VARIANT = release

ANDROID_PACKAGE_EXTENSION = apk
ANDROID_BUNDLE_EXTENSION = aab
ANDROID_REPORT_EXTENSION = html

ANDROID_BUILD_SUBDIRECTORY = app/build
ANDROID_REPORT_SUBDIRECTORY = $(ANDROID_BUILD_SUBDIRECTORY)/reports
ANDROID_OUTPUT_SUBDIRECTORY = $(ANDROID_BUILD_SUBDIRECTORY)/outputs
ANDROID_PACKAGE_SUBDIRECTORY = $(ANDROID_OUTPUT_SUBDIRECTORY)/apk
ANDROID_BUNDLE_SUBDIRECTORY = $(ANDROID_OUTPUT_SUBDIRECTORY)/bundle

ANDROID_DEBUG_PACKAGE = $(ANDROID_PACKAGE_SUBDIRECTORY)/$(ANDROID_DEBUG_VARIANT)/$(ANDROID_APP_NAME)-$(ANDROID_DEBUG_VARIANT).$(ANDROID_PACKAGE_EXTENSION)
ANDROID_RELEASE_PACKAGE = $(ANDROID_PACKAGE_SUBDIRECTORY)/$(ANDROID_RELEASE_VARIANT)/$(ANDROID_APP_NAME)-$(ANDROID_RELEASE_VARIANT).$(ANDROID_PACKAGE_EXTENSION)

ANDROID_DEBUG_BUNDLE = $(ANDROID_BUNDLE_SUBDIRECTORY)/$(ANDROID_DEBUG_VARIANT)/$(ANDROID_APP_NAME)-$(ANDROID_DEBUG_VARIANT).$(ANDROID_BUNDLE_EXTENSION)
ANDROID_RELEASE_BUNDLE = $(ANDROID_BUNDLE_SUBDIRECTORY)/$(ANDROID_RELEASE_VARIANT)/$(ANDROID_APP_NAME)-$(ANDROID_RELEASE_VARIANT).$(ANDROID_BUNDLE_EXTENSION)

ANDROID_DEBUG_REPORT = $(ANDROID_REPORT_SUBDIRECTORY)/$(ANDROID_REPORT_NAME)-results-$(ANDROID_DEBUG_VARIANT).$(ANDROID_REPORT_EXTENSION)
ANDROID_RELEASE_REPORT = $(ANDROID_REPORT_SUBDIRECTORY)/$(ANDROID_REPORT_NAME)-results-$(ANDROID_RELEASE_VARIANT).$(ANDROID_REPORT_EXTENSION)

core-debug:
	./gradlew -q :$(ANDROID_CORE_NAME):assembleDebug

core-release:
	./gradlew -q :$(ANDROID_CORE_NAME):assembleRelease

app-debug:
	./gradlew -q :$(ANDROID_APP_NAME):assembleDebug

app-release:
	./gradlew -q :$(ANDROID_APP_NAME):assembleRelease

bundle-debug:
	./gradlew -q :$(ANDROID_APP_NAME):bundleDebug

bundle-release:
	./gradlew -q :$(ANDROID_APP_NAME):bundleRelease

lint-debug:
	./gradlew -q lintDebug

lint-release:
	./gradlew -q lintRelease

install-debug:
	adb install -r -d $(ANDROID_DEBUG_PACKAGE)

install-release:
	adb install -r $(ANDROID_RELEASE_PACKAGE)

symbolic-links:
	ln -s -f $(ANDROID_DEBUG_PACKAGE) $(ANDROID_ROOT_NAME)-$(ANDROID_DEBUG_VARIANT).$(ANDROID_PACKAGE_EXTENSION)
	ln -s -f $(ANDROID_RELEASE_PACKAGE) $(ANDROID_ROOT_NAME)-$(ANDROID_RELEASE_VARIANT).$(ANDROID_PACKAGE_EXTENSION)
	ln -s -f $(ANDROID_DEBUG_BUNDLE) $(ANDROID_ROOT_NAME)-$(ANDROID_DEBUG_VARIANT).$(ANDROID_BUNDLE_EXTENSION)
	ln -s -f $(ANDROID_RELEASE_BUNDLE) $(ANDROID_ROOT_NAME)-$(ANDROID_RELEASE_VARIANT).$(ANDROID_BUNDLE_EXTENSION)
	ln -s -f $(ANDROID_DEBUG_REPORT) $(ANDROID_REPORT_NAME)-$(ANDROID_DEBUG_VARIANT).$(ANDROID_REPORT_EXTENSION)
	ln -s -f $(ANDROID_RELEASE_REPORT) $(ANDROID_REPORT_NAME)-$(ANDROID_RELEASE_VARIANT).$(ANDROID_REPORT_EXTENSION)

clean:
	./gradlew -q clean

uninstall-assets: uninstall-drivers uninstall-messages uninstall-tables

uninstall-drivers:
	./gradlew -q :$(ANDROID_APP_NAME):uninstallDrivers

uninstall-messages:
	./gradlew -q :$(ANDROID_APP_NAME):uninstallMessages

uninstall-tables:
	./gradlew -q :$(ANDROID_APP_NAME):uninstallTables

purge: clean
	-rm -f -r .gradle

